# This YAML configuration file is used by the updatecli tool to automate the process of updating Temurin JDK versions
# managed by SDKMAN in a GitPod Dockerfile. It defines the sources from which to retrieve the latest JDK versions,
# the targets where these versions should be applied, and the actions to take upon successful updates.

# Define the source control management (SCM) configuration for GitHub.
scms:
  default:
    kind: github
    spec:
      user: "{{ .github.user }}" # The GitHub username to use for commits.
      email: "{{ .github.email }}" # The email associated with the GitHub user.
      owner: "{{ .github.owner }}" # The owner of the repository where changes will be made.
      repository: "{{ .github.repository }}" # The repository to update.
      token: "{{ requiredEnv .github.token }}" # GitHub token for authentication, marked as required.
      username: "{{ .github.username }}" # GitHub username for authentication.
      branch: "{{ .github.branch }}" # The branch to update with new JDK versions.

# Define the sources from which to retrieve the latest JDK versions using SDKMAN.
sources:
  JDK8:
    name: Get the latest JDK8 version from SDKMAN
    kind: shell
    spec:
      command: bash updatecli/scripts/get-jdk-versions.sh 8 # Shell command to get JDK 8 version.
      environments:
        - name: HOME
  # Similar configurations are repeated for JDK 11, JDK 17, and JDK 21, each retrieving their respective versions.

# Define the targets where the JDK versions will be applied.
targets:
  setJDK8:
    kind: dockerfile
    spec:
      file: .gitpod/Dockerfile # The Dockerfile to update.
      instruction:
        keyword: "ARG" # The Dockerfile instruction to target.
        matcher: "JDK8_PACKAGE" # The specific ARG to update with the new JDK 8 version.
    name: "[GitPod] Update the JDK8 version for SDKMAN"
    sourceid: JDK8 # Link to the source of JDK 8 version.
    scmid: default # Use the default SCM configuration.
  # Similar target configurations are provided for JDK 11, JDK 17, and JDK 21.

# Define the actions to take after the targets are updated.
actions:
  default:
    kind: github/pullrequest
    scmid: default # Use the default SCM configuration.
    title: "[plugins] Update the versions of the temurin installers from SDKMAN"
    spec:
      labels: # Labels to add to the GitHub pull request.
        - chore
        - JDK
        - SDKMAN
        - docker
        - updatecli
# TODO: create a .properties file to store the versions so it can be used by Java!
# Maybe in src/main/resources/sdkman.properties
